services:
  # 後端服務
  backend:
    build: ./backend
    volumes:
      - ./backend:/app
      - /app/node_modules # 避免本機 node_modules 蓋掉容器內的 linux 版本套件
    ports:
      - "5000:5000"
    env_file:
      - ./backend/.env
    # 使用你 package.json 裡的 dev 指令
    command: npm run dev 
    restart: always

  # 前端服務
  frontend:
    build:
      context: ./frontend      # 指向前端資料夾
      dockerfile: Dockerfile.dev
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app        # 本地程式碼對應到容器 /app
      - /app/node_modules      # 匿名卷，保護容器內的 node_modules
      - /app/.next             # 匿名卷，避免編譯暫存衝突
    environment:
      - WATCHPACK_POLLING=true # 讓 Docker 能感應到檔案存檔
      - NODE_ENV=development